---
layout: post
title: "💻 [Theory] 데이터베이스 트랜젝션(Transaction)"
category : Theory
tags: [theory, database, db, transaction]
---

# 💻 [Theory] 데이터베이스 트랜젝션(Transaction)

    이번에는 데이터베이스의 트랜잭션에 대해 알아보겠습니다.

## 데이터베이스 트랜젝션(Transaction)란 무엇인가?

데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.

> ※ 한꺼번에 모두 수행이 되거나 아니면 모두 수행이 되지 않아야 한다.
 
트랜잭션을 설명하기 위해 은행 거래를 예시로 들 수 있다.

ATM으로 계좌이체를 한다고 생각해보면,

1. A 은행에서 출금하여 B 은행으로 송금하려고 한다.

2. 송금 도중, 알 수 없는 오류가 발생하여 A 은행 계좌에서 돈은 빠져 나갔지만 B 은행의 계좌에 입금되지 않았다.
    - 돈이 증발 => 심각한 문제

3. 이와 같은 상황을 막기위해 거래가 성공적으로 모두 끝나야 이를 완전한 거래로 승인하고, 거래 도중 뭔가 오류가 발생했을 때는 이 거래를 처음부터 없었던 거래로 완전히 되돌리는 것이다.

        이렇게 거래의 안전성을 확보하는 방법이 트랜잭션이다. 데이터베이스에선 테이블에서 데이터를 읽어 온 후
        다른 테이블에 데이터를 입력하거나 갱신, 삭제하는데 처리 도중 오류가 발생하면 모든 작업을 원상태로 되돌린다.
        데이터베이스에서 처리 과정이 모두 정상적으로 성공했을 때만 최종적으로 데이터베이스에 반영한다.
        ※ 트랜잭션의 특징인 ACID와 관련이 밀접하다.  

## 트랜잭션(Transaction)의 특징

위에서 말한 것처럼 트랜잭션의 특징은 ACID 4가지가 있다.

ACID(Atomicity, Consistency, Isolation, Durability)는 데이터베이스 트랜젝션이 안전하게 수행된다는 것을 보장하기 위한 트랜잭션의 특징을 말한다.

- 원자성(Atomicity) : 트랜잭션이 DB에 모두 반영되거나, 혹은 전혀 반영되지 않아야 한다.
    
    - 트랜잭션의 작업이 부분적으로 실행되거나 중단되지 않는 것을 보장하는 것을 말한다.
    - All or Noting 의 개념으로서 작업 단위를 일부분만 실행하지 않는다는 것을 의미한다.

- 일관성(Consistency) : 트랜잭션의 작업 처리 결과는 항상 일관성이 있어야 한다.
    
    - 트랜잭션이 성공적으로 완료될 때 일관적인 DB 상태를 유지하는 것을 말한다.
    - 여기서 말하는 일관성이란, 위의 송금 예제에서 금액의 데이터 타입이 정수형(integer)인데, 갑자기 문자열(string)이 되지 않는 것을 말한다.
        - 즉, 송금 전후 모두 금액의 데이터 타입은 정수형이여야 한다는 것이 일관성이다.

> ※ 트랜잭션에서 일관성은 트랜잭션 수행 전, 후에 데이터 모델의 모든 제약 조건(기본키, 외래키, 도메인, 도메인 제약조건 등)을 만족하는 것

- 격리성(Isolation) : 둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 때, 어떤 트랜잭션도 다른 트랜잭션 연산에 끼어들 수 없다.

    - 트랜잭션 수행시 다른 트랜잭션의 작업이 끼어들지 못하도록 보장하는 것을 말한다.
    - 즉, 트랜잭션끼리는 서로를 간섭할 수 없다.

- 지속성(Durability) : 트랜잭션이 성공적으로 완료 되었으면 결과는 영구적으로 반영되어야 한다.

    - 성공적으로 수행된 트랜잭션은 영원히 반영이 되는 것을 말한다.
    - commit을 하면 현재 상태는 영원히 보장된다.

## 트랜잭션(Transaction)의 상태

하나의 트랜잭션이 완전히 반영되거나 아니면 완전히 철회가 되기 위해서 다음과 같은 상태를 가진다.

![transaction-status](/images/2021-6-3/transaction-status.png)

- 활성(Active) : 트랜잭션이 정상적으로 실행중인 상태
- 실패(Failed) : 트랜잭션 실행에 오류가 발생하여 중단된 상태
- 철회(Aborted) : 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
- 부분 완료(Partially Committed) : 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
- 완료(Committed) : 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태

### 끝

    데이터베이스의 트랜잭션에 대해 알아보았습니다.
    감사합니다. 🙏
    
-------------------------------------------------

Reference

<https://victorydntmd.tistory.com/129>

<https://coding-factory.tistory.com/226>